## Introduction

### Problem Formulation

In this project we are developing a Intermediate Representation (IR) generator (we decided to call it "intermediator" ðŸ˜Ž) for a C based programming language. The IR generator will take an abstract syntax tree (AST) produced by the parser and convert it into an intermediate representation that can be used for further optimization and code generation.

### Motivation

Once we have a parser and the code is already semantically correct, the next step in the compilation process is to generate an intermediate representation (IR) of the program. The IR serves as a bridge between the high-level source code and the low-level machine code, allowing for optimizations and transformations that are independent of the target architecture.

### Objectives

The main objective of this project is to implement an IR generator that takes an AST as input and produces an intermediate representation of the program. The IR should be designed to be simple and easy to manipulate, while still being expressive enough to represent the semantics of the original program.

## Technologies

We will be using pure Python for the implementation of the IR generator.

## Theoretical Framework

### Intermediate Representation (IR)

An intermediate representation (IR) is a data structure or code that represents the program at an intermediate level between the high-level source code and the low-level machine code. The IR is designed to be easy to analyze and manipulate, allowing for optimizations and transformations that can improve the performance of the final generated code.

### Abstract Syntax Tree (AST)

An abstract syntax tree (AST) is a tree representation of the abstract syntactic structure of source code. Each node in the tree represents a construct occurring in the source code. The AST is generated by the parser and serves as the input for the IR generator.

### Semantic Analysis

Semantic analysis is the process of checking the semantic correctness of the program. It involves verifying that the program adheres to the rules of the language, such as type checking, scope resolution, and other language-specific constraints. The semantic analyzer will ensure that the AST is valid before it is passed to the IR generator.

### Code Generation

Code generation is the process of converting the intermediate representation into machine code or another lower-level representation that can be executed by a computer. The IR generator will produce an IR that can be further transformed and optimized before the final code generation step.

## Development

### Design Considerations

We can remember that this C based programming language is a simplified version of C, the limitations are:

-   Only supports the 'int' type
-   Functions don't accept parameters
-   No loops for are defined
-   No array or pointer support
-   Our L1 tag is the main function, so it does not appear in the IR

The grammar of the language can be found in the `parser/README.md` file, which describes the syntax of the language. The semantic analyzer will use this grammar to validate the semantic correctness of the program.

### Implementation

The IR generator is implemented in the `intermediator` directory. The main components of the IR generator include:

-   **IR Instruction Classes**: Classes that represent different types of IR instructions
-   **IR Generator**: The main class that traverses the AST and generates the intermediate representation
-   **Visitor Pattern**: The IR generator uses the visitor pattern to traverse the AST and generate the corresponding IR instructions
-   **Error Handling**: The IR generator provides meaningful error messages when unhandled AST node types are encountered

#### IR Instruction Set

The intermediator supports the following IR instruction types:

-   **LabelInstr**: Represents labels for control flow (e.g., `main:`, `L1:`)
-   **AssignInstr**: Variable assignments (e.g., `x = 5`, `t1 = y`)
-   **BinaryOpInstr**: Binary operations (e.g., `t1 = x + y`, `t2 = a == b`)
-   **JumpInstr**: Unconditional jumps (e.g., `goto L1`)
-   **ConditionalJumpInstr**: Conditional jumps (e.g., `if_false t1 goto L2`)
-   **ReturnInstr**: Function returns (e.g., `return x`, `return 0`)
-   **PrintInstr**: Print statements (e.g., `print x`, `print "hello"`)

#### Supported Language Features

The IR generator handles the following AST node types:

-   **Program and Function declarations**: Multiple functions with proper labeling
-   **Variable declarations**: With optional initialization expressions
-   **Variable assignments**: Simple assignments and complex expressions
-   **Binary operations**: Arithmetic (+, -, \*, /) and comparison (==, !=, <, <=, >, >=) operators
-   **Conditional statements**: if and if-else constructs with proper control flow
-   **While loops**: Loop constructs with condition checking and proper jumps
-   **Print statements**: Support for printing variables, constants, and string literals
-   **Block statements**: Proper handling of statement blocks
-   **Constants and identifiers**: Basic value and variable references
-   **Function calls**: Support for function calls, but no parameters and no return values

#### Technical Details

-   **Temporary Variables**: Generated using pattern `t1`, `t2`, etc. for intermediate results
-   **Label Generation**: Automatic label creation using pattern `L1`, `L2`, etc. for control flow
-   **Three-Address Code**: IR follows three-address code principles for easy translation to assembly
-   **Control Flow**: Proper handling of conditional jumps and unconditional jumps for if-else and while constructs

## Usage

To use the IR generator, you need to:

1. Parse your source code to get an AST (using the parser module)
2. Optionally run semantic analysis (using the semanter module)
3. Generate IR from the AST

## Limitations and Known Issues

-   **For Loops**: The language grammar does not support for loops, only while loops are implemented.
-   **Function Parameters**: Functions cannot accept parameters in this simplified C variant.
-   **Arrays and Pointers**: No support for array or pointer operations.
-   **Type System**: Only `int` type is supported.

## References

-   S. GeeksforGeeks, "Intermediate Code Generation in Compiler Design" [Online]. Available: https://www.geeksforgeeks.org/intermediate-code-generation-in-compiler-design/. [Accessed: 01-Jun-2025].
